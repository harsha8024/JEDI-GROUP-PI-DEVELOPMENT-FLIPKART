<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FlipFit API Tester</title>
  <link rel="stylesheet" href="./stylesheet.css">
  <style>
    body{font-family:Segoe UI,Arial,Helvetica,sans-serif;padding:18px}
    .row{display:flex;gap:8px;margin-bottom:8px}
    label{width:120px;font-weight:600}
    input[type=text],select,textarea{flex:1;padding:6px;border:1px solid #ccc;border-radius:4px}
    textarea{height:160px;font-family:monospace}
    .btn{padding:8px 12px;border:0;background:#1976d2;color:#fff;border-radius:4px;cursor:pointer}
    .btn-secondary{background:#6c757d}
    #response{white-space:pre-wrap;background:#0b132024;padding:12px;border-radius:6px;border:1px solid #ddd;margin-top:12px}
    .presets{display:flex;flex-wrap:wrap;gap:6px}
    .preset{background:#eee;padding:6px;border-radius:4px;cursor:pointer}
  </style>
</head>
<body>
  <h1>FlipFit API Tester</h1>
  <p>Use this simple one-page UI to send requests to your local Dropwizard API (like Postman).</p>

  <div class="row">
    <label for="baseUrl">Base URL</label>
    <input id="baseUrl" type="text" value="http://localhost:8080" />
  </div>

  <div class="row">
    <label for="method">Method</label>
    <select id="method">
      <option>GET</option>
      <option>POST</option>
      <option>PUT</option>
      <option>DELETE</option>
    </select>
    <label for="path">Path</label>
    <input id="path" type="text" placeholder="/user/login or /customer/gyms" />
  </div>

  <div class="row">
    <label>Query Params</label>
    <input id="query" type="text" placeholder="e.g. key1=val1&key2=val2" />
  </div>

  <div class="row">
    <label>Headers</label>
    <input id="headers" type="text" placeholder='e.g. Content-Type=application/json; Authorization=Bearer ...' />
  </div>

  <div class="row">
    <label>Body (JSON)</label>
  </div>
  <textarea id="body" placeholder='{"username":"john","password":"secret"}'></textarea>

  <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
    <button id="send" class="btn">Send</button>
    <button id="clear" class="btn btn-secondary">Clear Response</button>
    <span id="status" style="margin-left:12px;font-weight:600"></span>
  </div>

  <h3>Presets (click to populate)</h3>
  <div class="presets" id="presets">
    <!-- Populated by script -->
  </div>

  <h3>Response</h3>
  <div id="response">No response yet.</div>

  <script>
    const presets = [
      // User Authentication
      {label:'POST /customer/register', method:'POST', path:'/customer/register', body:{"name":"","email":"","password":"","phoneNumber":"","city":""}},
      {label:'POST /customer/login', method:'POST', path:'/customer/login?email=&password='},
      {label:'POST /owner/register', method:'POST', path:'/owner/register', body:{"name":"","email":"","password":"","phoneNumber":"","city":"","panNumber":"","aadharNumber":"","gstinNumber":""}},
      {label:'POST /owner/login', method:'POST', path:'/owner/login?email=&password='},
      {label:'POST /admin/login', method:'POST', path:'/admin/login?email=&password='},
      
      // Customer Operations
      {label:'GET /customer/gyms', method:'GET', path:'/customer/gyms'},
      {label:'GET /customer/gyms/{gymId}/slots', method:'GET', path:'/customer/gyms/{gymId}/slots?date=2026-01-29'},
      {label:'POST /customer/book', method:'POST', path:'/customer/book?userId=&slotId=&gymId=&date=2026-01-29'},
      {label:'PUT /customer/cancel/{bookingId}', method:'PUT', path:'/customer/cancel/{bookingId}?userId='},
      {label:'GET /customer/bookings/{userId}', method:'GET', path:'/customer/bookings/{userId}'},
      
      // Owner Operations
      {label:'POST /owner/gyms/register', method:'POST', path:'/owner/gyms/register', body:{"gymName":"","location":"","gymOwnerId":""}},
      {label:'GET /owner/gyms/{ownerId}', method:'GET', path:'/owner/gyms/{ownerId}'},
      {label:'GET /owner/bookings/{ownerId}', method:'GET', path:'/owner/bookings/{ownerId}'},
      {label:'POST /owner/slots/create', method:'POST', path:'/owner/slots/create?gymId=&startTime=09:00&endTime=10:00&capacity=10'},
      {label:'GET /owner/slots/{gymId}', method:'GET', path:'/owner/slots/{gymId}'},
      {label:'PUT /owner/slots/{slotId}', method:'PUT', path:'/owner/slots/{slotId}?capacity=15'},
      {label:'DELETE /owner/slots/{slotId}', method:'DELETE', path:'/owner/slots/{slotId}'},
      
      // Admin Operations
      {label:'GET /admin/gyms/pending', method:'GET', path:'/admin/gyms/pending'},
      {label:'PUT /admin/gyms/approve/{gymId}', method:'PUT', path:'/admin/gyms/approve/{gymId}'},
      {label:'PUT /admin/gyms/reject/{gymId}', method:'PUT', path:'/admin/gyms/reject/{gymId}'},
      {label:'GET /admin/owners/pending', method:'GET', path:'/admin/owners/pending'},
      {label:'PUT /admin/owners/approve/{ownerId}', method:'PUT', path:'/admin/owners/approve/{ownerId}'},
      {label:'PUT /admin/owners/reject/{ownerId}', method:'PUT', path:'/admin/owners/reject/{ownerId}'},
      {label:'GET /admin/users', method:'GET', path:'/admin/users'},
      {label:'GET /admin/gyms', method:'GET', path:'/admin/gyms'},
      
      // Slot Operations
      {label:'GET /slot/gym/{gymId}', method:'GET', path:'/slot/gym/{gymId}'},
      {label:'POST /slot/create', method:'POST', path:'/slot/create', body:{"gymId":"","startTime":"09:00","endTime":"10:00","capacity":10}},
      {label:'GET /slot/{slotId}', method:'GET', path:'/slot/{slotId}'},
      
      // Payment Operations
      {label:'POST /payment/process', method:'POST', path:'/payment/process', body:{"bookingId":"","amount":0}},
      {label:'GET /payment/{paymentId}', method:'GET', path:'/payment/{paymentId}'},
      
      // Notification Operations
      {label:'POST /notification/send', method:'POST', path:'/notification/send', body:{"userId":"","message":""}},
      {label:'GET /notification/unread/{userId}', method:'GET', path:'/notification/unread/{userId}'}
    ];

    const presetsEl = document.getElementById('presets');
    presets.forEach(p=>{
      const btn = document.createElement('div'); btn.className='preset'; btn.textContent=p.label;
      btn.onclick = ()=>{
        document.getElementById('method').value = p.method;
        document.getElementById('path').value = p.path;
        document.getElementById('body').value = p.body ? JSON.stringify(p.body, null, 2) : '';
      };
      presetsEl.appendChild(btn);
    });

    function parseHeaders(str){
      const out = {};
      if(!str) return out;
      str.split(';').map(s=>s.trim()).filter(Boolean).forEach(pair=>{
        const idx = pair.indexOf('='); if(idx===-1) return; const k=pair.slice(0,idx).trim(); const v=pair.slice(idx+1).trim(); out[k]=v;
      });
      return out;
    }

    document.getElementById('send').addEventListener('click', async ()=>{
      const base = document.getElementById('baseUrl').value.replace(/\/$/, '');
      const method = document.getElementById('method').value;
      let path = document.getElementById('path').value;
      const query = document.getElementById('query').value;
      const headersText = document.getElementById('headers').value;
      const bodyText = document.getElementById('body').value;

      if(query){
        if(path.indexOf('?')===-1) path += (path.includes('?')? '&':'?') + query;
        else path += '&' + query;
      }

      const url = base + (path.startsWith('/') ? path : '/' + path);
      const headers = parseHeaders(headersText);
      const opts = {method, headers: {...headers}};
      if(bodyText && (method==='POST' || method==='PUT')){
        if(!opts.headers['Content-Type']) opts.headers['Content-Type']='application/json';
        try{ opts.body = bodyText; }catch(e){ /* keep raw */ }
      }

      const statusEl = document.getElementById('status');
      const respEl = document.getElementById('response');
      statusEl.textContent = 'Sending...'; respEl.textContent = '';

      try{
        const res = await fetch(url, opts);
        const ct = res.headers.get('content-type') || '';
        let data;
        if(ct.includes('application/json')) data = await res.json(); else data = await res.text();
        statusEl.textContent = res.status + ' ' + res.statusText;
        respEl.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
      }catch(err){
        statusEl.textContent = 'Error';
        respEl.textContent = String(err) + '\n\nNote: If you see CORS errors, run a local static file server (see instructions) or enable CORS in the Dropwizard app.';
      }
    });

    document.getElementById('clear').addEventListener('click', ()=>{document.getElementById('response').textContent=''; document.getElementById('status').textContent='';});
  </script>
</body>
</html>
