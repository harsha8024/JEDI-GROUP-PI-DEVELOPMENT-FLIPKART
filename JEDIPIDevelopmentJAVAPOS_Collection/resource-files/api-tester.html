<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FlipFit API Tester</title>
  <link rel="stylesheet" href="./stylesheet.css">
  <style>
    body{font-family:Segoe UI,Arial,Helvetica,sans-serif;padding:18px;max-width:1400px;margin:0 auto}
    .row{display:flex;gap:8px;margin-bottom:8px;align-items:center}
    label{width:120px;font-weight:600;flex-shrink:0}
    input[type=text],select,textarea{flex:1;padding:6px;border:1px solid #ccc;border-radius:4px}
    textarea{height:160px;font-family:monospace}
    .btn{padding:8px 12px;border:0;background:#1976d2;color:#fff;border-radius:4px;cursor:pointer}
    .btn:hover{background:#1565c0}
    .btn-secondary{background:#6c757d}
    .btn-secondary:hover{background:#5a6268}
    #response{white-space:pre-wrap;background:#0b132024;padding:12px;border-radius:6px;border:1px solid #ddd;margin-top:12px;max-height:400px;overflow:auto}
    .presets{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:6px;margin-top:8px}
    .preset{background:#eee;padding:8px 12px;border-radius:4px;cursor:pointer;border:1px solid #ddd;transition:all 0.2s}
    .preset:hover{background:#ddd;border-color:#999}
    .preset-category{font-weight:700;font-size:0.95em;background:#333;color:#fff;padding:8px;border-radius:4px;margin-top:12px;margin-bottom:4px}
    .cors-warning{background:#fff3cd;border:1px solid #ffc107;padding:12px;border-radius:6px;margin-bottom:16px;color:#856404}
    .cors-warning strong{display:block;margin-bottom:6px}
  </style>
</head>
<body>
  <h1>FlipFit API Tester</h1>
  <p>Complete API testing tool for your Dropwizard REST endpoints.</p>
  
  <div class="cors-warning">
    <strong>⚠️ CORS Note:</strong>
    If you get CORS errors, the Dropwizard app must enable CORS headers. This HTML can be opened directly from filesystem or served via: 
    <code>python -m http.server 8000</code> (then visit http://localhost:8000/api-tester.html)
  </div>

  <div class="row">
    <label for="baseUrl">Base URL</label>
    <input id="baseUrl" type="text" value="http://localhost:8080" />
  </div>

  <div class="row">
    <label for="method">Method</label>
    <select id="method">
      <option>GET</option>
      <option>POST</option>
      <option>PUT</option>
      <option>DELETE</option>
    </select>
    <label for="path">Path</label>
    <input id="path" type="text" placeholder="/user/login or /customer/gyms" />
  </div>

  <div class="row">
    <label>Query Params</label>
    <input id="query" type="text" placeholder="e.g. key1=val1&key2=val2" />
  </div>

  <div class="row">
    <label>Headers</label>
    <input id="headers" type="text" placeholder='e.g. Content-Type=application/json; Authorization=Bearer ...' />
  </div>

  <div class="row">
    <label>Body (JSON)</label>
  </div>
  <textarea id="body" placeholder='{"username":"john","password":"secret"}'></textarea>

  <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
    <button id="send" class="btn">Send</button>
    <button id="clear" class="btn btn-secondary">Clear Response</button>
    <span id="status" style="margin-left:12px;font-weight:600"></span>
  </div>

  <h3>Presets (click to populate)</h3>
  <div class="presets" id="presets">
    <!-- Populated by script -->
  </div>

  <h3>Response</h3>
  <div id="response">No response yet.</div>

  <script>
    const presets = [
      // === USER AUTHENTICATION ===
      {cat:'User', label:'POST /user/login', method:'POST', path:'/user/login?email=user@example.com&password=pass123'},
      {cat:'User', label:'POST /user/register', method:'POST', path:'/user/register', body:{name:"John Doe",email:"john@example.com",password:"pass123",phoneNumber:"1234567890",city:"Mumbai"}},
      {cat:'User', label:'PUT /user/update-password', method:'PUT', path:'/user/update-password?email=user@example.com&password=newpass123'},
      {cat:'User', label:'POST /user/logout', method:'POST', path:'/user/logout'},
      
      // === CUSTOMER OPERATIONS ===
      {cat:'Customer', label:'POST /customer/register', method:'POST', path:'/customer/register', body:{name:"Jane Customer",email:"jane@example.com",password:"pass123",phoneNumber:"9876543210",city:"Delhi"}},
      {cat:'Customer', label:'POST /customer/login', method:'POST', path:'/customer/login?email=jane@example.com&password=pass123'},
      {cat:'Customer', label:'GET /customer/gyms', method:'GET', path:'/customer/gyms'},
      {cat:'Customer', label:'GET /customer/gyms/{gymId}/slots', method:'GET', path:'/customer/gyms/GYM001/slots?date=2026-02-01'},
      {cat:'Customer', label:'POST /customer/book', method:'POST', path:'/customer/book?userId=USER001&slotId=SLOT001&gymId=GYM001&date=2026-02-01'},
      {cat:'Customer', label:'PUT /customer/cancel/{bookingId}', method:'PUT', path:'/customer/cancel/BOOK001?userId=USER001'},
      {cat:'Customer', label:'GET /customer/bookings/{userId}', method:'GET', path:'/customer/bookings/USER001'},
      
      // === GYM OWNER OPERATIONS ===
      {cat:'Owner', label:'POST /owner/register', method:'POST', path:'/owner/register', body:{name:"Gym Owner",email:"owner@example.com",password:"pass123",phoneNumber:"1112223333",city:"Bangalore",panNumber:"ABCDE1234F",aadharNumber:"123456789012",gstinNumber:"22ABCDE1234F1Z5"}},
      {cat:'Owner', label:'POST /owner/login', method:'POST', path:'/owner/login?email=owner@example.com&password=pass123'},
      {cat:'Owner', label:'POST /owner/gyms/register', method:'POST', path:'/owner/gyms/register', body:{gymName:"PowerFit Gym",location:"Bangalore",gymOwnerId:"OWNER001"}},
      {cat:'Owner', label:'GET /owner/gyms/{ownerId}', method:'GET', path:'/owner/gyms/OWNER001'},
      {cat:'Owner', label:'GET /owner/bookings/{ownerId}', method:'GET', path:'/owner/bookings/OWNER001'},
      {cat:'Owner', label:'POST /owner/slots/create', method:'POST', path:'/owner/slots/create?gymId=GYM001&startTime=09:00&endTime=10:00&capacity=20'},
      {cat:'Owner', label:'GET /owner/slots/{gymId}', method:'GET', path:'/owner/slots/GYM001'},
      {cat:'Owner', label:'PUT /owner/slots/{slotId}', method:'PUT', path:'/owner/slots/SLOT001?capacity=25'},
      {cat:'Owner', label:'DELETE /owner/slots/{slotId}', method:'DELETE', path:'/owner/slots/SLOT001'},
      {cat:'Owner', label:'PUT /owner/schedule/update', method:'PUT', path:'/owner/schedule/update?gymId=GYM001'},
      
      // === ADMIN OPERATIONS ===
      {cat:'Admin', label:'POST /admin/login', method:'POST', path:'/admin/login?email=admin@flipfit.com&password=admin123'},
      {cat:'Admin', label:'GET /admin/users', method:'GET', path:'/admin/users'},
      {cat:'Admin', label:'GET /admin/gyms', method:'GET', path:'/admin/gyms'},
      {cat:'Admin', label:'GET /admin/gyms/pending', method:'GET', path:'/admin/gyms/pending'},
      {cat:'Admin', label:'GET /admin/gyms/approved', method:'GET', path:'/admin/gyms/approved'},
      {cat:'Admin', label:'GET /admin/gyms/location/{location}', method:'GET', path:'/admin/gyms/location/Bangalore'},
      {cat:'Admin', label:'PUT /admin/gyms/approve/{gymId}', method:'PUT', path:'/admin/gyms/approve/GYM001'},
      {cat:'Admin', label:'PUT /admin/gyms/reject/{gymId}', method:'PUT', path:'/admin/gyms/reject/GYM001'},
      {cat:'Admin', label:'GET /admin/owners/approved', method:'GET', path:'/admin/owners/approved'},
      {cat:'Admin', label:'GET /admin/owners/pending', method:'GET', path:'/admin/owners/pending'},
      {cat:'Admin', label:'PUT /admin/owners/approve/{ownerId}', method:'PUT', path:'/admin/owners/approve/OWNER001'},
      {cat:'Admin', label:'PUT /admin/owners/reject/{ownerId}', method:'PUT', path:'/admin/owners/reject/OWNER001'},
      {cat:'Admin', label:'GET /admin/slots/pending', method:'GET', path:'/admin/slots/pending'},
      {cat:'Admin', label:'PUT /admin/slots/approve/{slotId}', method:'PUT', path:'/admin/slots/approve/SLOT001'},
      {cat:'Admin', label:'PUT /admin/slots/reject/{slotId}', method:'PUT', path:'/admin/slots/reject/SLOT001'},
      {cat:'Admin', label:'GET /admin/bookings', method:'GET', path:'/admin/bookings'},
      {cat:'Admin', label:'GET /admin/reports', method:'GET', path:'/admin/reports?reportType=1'},
      {cat:'Admin', label:'GET /admin/reports/payment', method:'GET', path:'/admin/reports/payment'},
      {cat:'Admin', label:'GET /admin/reports/revenue', method:'GET', path:'/admin/reports/revenue?startDate=2026-01-01&endDate=2026-01-31'},
      
      // === SLOT OPERATIONS ===
      {cat:'Slot', label:'POST /slot/create', method:'POST', path:'/slot/create?gymId=GYM001&startTime=14:00&endTime=15:00&capacity=15'},
      {cat:'Slot', label:'GET /slot/gym/{gymId}', method:'GET', path:'/slot/gym/GYM001'},
      {cat:'Slot', label:'GET /slot/{slotId}', method:'GET', path:'/slot/SLOT001'},
      {cat:'Slot', label:'PUT /slot/{slotId}', method:'PUT', path:'/slot/SLOT001?capacity=18'},
      {cat:'Slot', label:'DELETE /slot/{slotId}', method:'DELETE', path:'/slot/SLOT001'},
      
      // === PAYMENT OPERATIONS ===
      {cat:'Payment', label:'POST /payment/process', method:'POST', path:'/payment/process?bookingId=BOOK001&amount=500&paymentMethod=CARD'},
      {cat:'Payment', label:'GET /payment/{paymentId}', method:'GET', path:'/payment/PAY001'},
      {cat:'Payment', label:'POST /payment/refund/{paymentId}', method:'POST', path:'/payment/refund/PAY001'},
      
      // === NOTIFICATION OPERATIONS ===
      {cat:'Notification', label:'POST /notification/send', method:'POST', path:'/notification/send?userId=USER001&message=Your%20booking%20confirmed&title=Booking%20Confirmation'},
      {cat:'Notification', label:'GET /notification/unread/{userId}', method:'GET', path:'/notification/unread/USER001'},
      {cat:'Notification', label:'PUT /notification/mark-read/{notificationId}', method:'PUT', path:'/notification/mark-read/NOTIF001'},
      
      // === REGISTRATION OPERATIONS ===
      {cat:'Registration', label:'POST /registration/create', method:'POST', path:'/registration/create?userId=USER001&role=CUSTOMER'},
      {cat:'Registration', label:'GET /registration/pending', method:'GET', path:'/registration/pending'},
      {cat:'Registration', label:'PUT /registration/approve/{registrationId}', method:'PUT', path:'/registration/approve/REG001?adminId=ADMIN001'},
      {cat:'Registration', label:'PUT /registration/reject/{registrationId}', method:'PUT', path:'/registration/reject/REG001?adminId=ADMIN001'}
    ];

    // Group presets by category and render
    const categories = [...new Set(presets.map(p=>p.cat))];
    const presetsEl = document.getElementById('presets');
    categories.forEach(cat=>{
      const catHeader = document.createElement('div');
      catHeader.className = 'preset-category';
      catHeader.textContent = cat;
      presetsEl.appendChild(catHeader);
      
      presets.filter(p=>p.cat===cat).forEach(p=>{
        const btn = document.createElement('div');
        btn.className='preset';
        btn.textContent=p.label;
        btn.onclick = ()=>{
          document.getElementById('method').value = p.method;
          document.getElementById('path').value = p.path;
          document.getElementById('body').value = p.body ? JSON.stringify(p.body, null, 2) : '';
        };
        presetsEl.appendChild(btn);
      });
    });

    function parseHeaders(str){
      const out = {};
      if(!str) return out;
      str.split(';').map(s=>s.trim()).filter(Boolean).forEach(pair=>{
        const idx = pair.indexOf('='); if(idx===-1) return; const k=pair.slice(0,idx).trim(); const v=pair.slice(idx+1).trim(); out[k]=v;
      });
      return out;
    }

    document.getElementById('send').addEventListener('click', async ()=>{
      const base = document.getElementById('baseUrl').value.replace(/\/$/, '');
      const method = document.getElementById('method').value;
      let path = document.getElementById('path').value;
      const query = document.getElementById('query').value;
      const headersText = document.getElementById('headers').value;
      const bodyText = document.getElementById('body').value;

      if(query){
        if(path.indexOf('?')===-1) path += (path.includes('?')? '&':'?') + query;
        else path += '&' + query;
      }

      const url = base + (path.startsWith('/') ? path : '/' + path);
      const headers = parseHeaders(headersText);
      const opts = {method, headers: {...headers}};
      if(bodyText && (method==='POST' || method==='PUT')){
        if(!opts.headers['Content-Type']) opts.headers['Content-Type']='application/json';
        try{ opts.body = bodyText; }catch(e){ /* keep raw */ }
      }

      const statusEl = document.getElementById('status');
      const respEl = document.getElementById('response');
      statusEl.textContent = 'Sending...'; respEl.textContent = '';

      try{
        const res = await fetch(url, opts);
        const ct = res.headers.get('content-type') || '';
        let data;
        if(ct.includes('application/json')) data = await res.json(); else data = await res.text();
        statusEl.textContent = res.status + ' ' + res.statusText;
        respEl.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
      }catch(err){
        statusEl.textContent = 'Error';
        respEl.textContent = String(err) + '\n\nNote: If you see CORS errors, run a local static file server (see instructions) or enable CORS in the Dropwizard app.';
      }
    });

    document.getElementById('clear').addEventListener('click', ()=>{document.getElementById('response').textContent=''; document.getElementById('status').textContent='';});
  </script>
</body>
</html>
